(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-add~pages-index-update"],{"14e3":function(e,t,i){"use strict";var n=i("a202"),a=i.n(n);a.a},"2c4d":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uniForms:i("71e4").default,uniFormsItem:i("aeba").default,uniEasyinput:i("17de").default,uniDataSelect:i("1e7f").default,uniFilePicker:i("9612").default,uniPopup:i("be18").default,uniPopupMessage:i("bd5d").default},a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"view"},[["update"].includes(e.type)?i("v-uni-view",{staticStyle:{"font-size":"16px","font-weight":"bold"}},[e._v("编辑")]):i("v-uni-view",{staticStyle:{"font-size":"16px","font-weight":"bold"}},[e._v("新增")]),i("uni-forms",{attrs:{modelValue:e.form,"label-position":"left","label-width":"100px"}},[i("uni-forms-item",{attrs:{label:"商品名称:",name:"spuName"}},[i("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入商品名称"},model:{value:e.form.spuName,callback:function(t){e.$set(e.form,"spuName",t)},expression:"form.spuName"}})],1),i("uni-forms-item",{attrs:{label:"价格:",name:"price"}},[i("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入价格"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),i("uni-forms-item",{attrs:{label:"描述:",name:"desc"}},[i("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入标题"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),i("uni-forms-item",{attrs:{label:"所属分类:",name:"type"}},[i("uni-data-select",{staticStyle:{width:"400rpx"},attrs:{localdata:e.spuAllTypeOptsMixins},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.changeType.apply(void 0,arguments)}},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),i("uni-forms-item",{attrs:{label:"是否选为天天特价:",name:"dailySpecial"}},[i("uni-data-select",{staticStyle:{width:"400rpx"},attrs:{localdata:e.yesOrNoOpts},model:{value:e.form.dailySpecial,callback:function(t){e.$set(e.form,"dailySpecial",t)},expression:"form.dailySpecial"}})],1),i("uni-forms-item",{attrs:{label:"是否选为每日推荐:",name:"dailyRecommend"}},[i("uni-data-select",{staticStyle:{width:"400rpx"},attrs:{localdata:e.yesOrNoOpts},model:{value:e.form.dailyRecommend,callback:function(t){e.$set(e.form,"dailyRecommend",t)},expression:"form.dailyRecommend"}})],1),i("uni-forms-item",{attrs:{label:"上传主页图:",name:"mainUrl"}},[i("uni-file-picker",{ref:"uploadMain",attrs:{fileMediatype:"image","del-icon":!1,"disable-preview":!0,limit:"1"},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.selectMain.apply(void 0,arguments)}},model:{value:e.form.mainUrl,callback:function(t){e.$set(e.form,"mainUrl",t)},expression:"form.mainUrl"}})],1),i("uni-forms-item",{attrs:{label:"上传详情图:",name:"type"}},[i("uni-file-picker",{ref:"upload",attrs:{fileMediatype:"image",mode:"grid",limit:"9"},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.select.apply(void 0,arguments)},progress:function(t){arguments[0]=t=e.$handleEvent(t),e.progress.apply(void 0,arguments)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.success.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deletephoto.apply(void 0,arguments)},fail:function(t){arguments[0]=t=e.$handleEvent(t),e.fail.apply(void 0,arguments)}},model:{value:e.form.imgs,callback:function(t){e.$set(e.form,"imgs",t)},expression:"form.imgs"}})],1)],1),i("v-uni-view",{staticClass:"jump-next-area"},[i("v-uni-button",{staticClass:"jump-next submit",attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addSub.apply(void 0,arguments)}}},[e._v("保存")]),i("v-uni-button",{staticClass:"jump-next submit",attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleBut.apply(void 0,arguments)}}},[e._v("取消")])],1),i("v-uni-view",[i("uni-popup",{ref:"message",attrs:{type:"message"}},[i("uni-popup-message",{attrs:{type:e.msgType,message:e.messageText,duration:2e3}})],1)],1)],1)},o=[]},"55b8":function(e,t,i){"use strict";var n=i("4ea4");i("c740"),i("caad"),i("d81d"),i("a434"),i("d3b7"),i("ac1f"),i("3ca3"),i("5319"),i("ddb0"),i("2b3d"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(i("2909"));i("96cf");var o=n(i("1da1")),s=i("9114"),r=i("19aa9"),l=n(i("af28")),c={mixins:[r.spuAllTypeMixins],props:["type"],data:function(){return{bwCoinCDNUrl:s.bwCoinImgcdnUrl,msgType:"success",messageText:"",URL:URL,title:"新增",form:{spuName:"",price:"",title:"",type:"",mainUrl:[],imgs:[]},yesOrNoOpts:[{text:"是",value:"YES"},{text:"否",value:"NO"}]}},mounted:function(){console.log("this.type",this.type),this.initspuAllTypeOptsMixins(),["update"].includes(this.type)&&this.getDetail()},onLoad:function(e){e.item&&(this.form=JSON.parse(decodeURIComponent(e.item)))},methods:{getUrl:function(e){if(console.log("blob",e),0!=e.length){var t=null,i=[];return i.push(e[0].file),t=window.URL.createObjectURL(new Blob(i,{type:"application/pdf;chartset=UTF-8"})),console.log("url",t),console.log("this.form.mainUrl",t,this.form.mainUrl),t}},getDetail:function(){var e=this;l.default.getDetailApi({code:this.$route.query.code}).then((function(t){console.log("res---",t),e.form=t,e.form.mainUrl=[{url:e.bwCoinCDNUrl+t.mainUrl}],console.log("this.form.mainUrl",e.form.mainUrl),e.form.imgs=t.imgs.map((function(t){return{fileID:t.id,id:t.id,url:e.bwCoinCDNUrl+t.imgUrl,imgUrl:t.imgUrl}})),console.log("this.form.imgs",e.form.imgs)}))},addSub:function(){var e=this;return(0,o.default)(regeneratorRuntime.mark((function t(){var i,n,a,r,c,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.form.imgs,n=e.form.mainUrl,t.next=4,(0,s.getAliOosClient)("bwcoin");case 4:if(a=t.sent,!n||!n[0].file){t.next=15;break}return r=n,console.log("file",r),t.next=10,a.put("spu-main-url-"+e.form.spuName.replace(/\s/g,"-")+"."+r[0].extname,r[0].file);case 10:c=t.sent,console.log("result",c),e.form.mainUrl=[c.name],t.next=16;break;case 15:e.form.mainUrl=e.form.mainUrl.map((function(e){var t=e.url.replace("https://bwcoin.oss-cn-beijing.aliyuncs.com/","");return console.log("img",t),t}));case 16:return console.log("this.form.mainUrl",e.form.mainUrl),t.next=19,Promise.all(i.map(function(){var t=(0,o.default)(regeneratorRuntime.mark((function t(n,o){var s,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.file){t.next=10;break}return s=n,console.log("file",s),t.next=5,a.put("spu-imgs-"+e.form.spuName.replace(/\s/g,"-")+o+"."+s.extname,s.file);case 5:r=t.sent,console.log("result",r),i[o]={id:0,imgUrl:r.name},t.next=12;break;case 10:l=i[o].url.replace("https://bwcoin.oss-cn-beijing.aliyuncs.com/",""),i[o]={id:i[o].fileID,imgUrl:l};case 12:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}()));case 19:console.log("imgs",i),u={spuName:e.form.spuName,price:e.form.price,desc:e.form.desc,type:e.form.type,dailySpecial:e.form.dailySpecial,dailyRecommend:e.form.dailyRecommend,imgs:e.form.imgs,mainUrl:e.form.mainUrl[0]},console.log("params",u),e.form.spuCode?(u.spuCode=e.form.spuCode,l.default.spuUpdateApi(u).then((function(e){uni.showToast({title:"编辑成功"}),setTimeout((function(){uni.navigateBack({delta:1})}),2e3)}))):(console.log("params",u),l.default.spuCreateApi(u).then((function(e){uni.showToast({title:"新增成功"}),setTimeout((function(){uni.navigateBack({delta:1})}),2e3)})));case 23:case"end":return t.stop()}}),t)})))()},addSub1:function(){var e=this;return(0,o.default)(regeneratorRuntime.mark((function t(){var i,n,a,o,r,l,c,u,m,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.form.spuCode){t.next=5;break}i={spuName:e.form.spuName,price:e.form.price,desc:e.form.desc,spuCode:e.form.spuCode},uni.request({url:"".concat(e.$baseUrl,"/spu/update"),method:"POST",data:i,success:function(e){uni.showToast({title:"编辑成功"}),setTimeout((function(){uni.navigateBack({delta:1})}),2e3)},fail:function(e){}}),t.next=39;break;case 5:n=e.form.imgs,console.log("list",n),a=0;case 8:if(!(a<n.length)){t.next=24;break}if(console.log("list[i]",n[a]),"object"!==typeof n[a]){t.next=21;break}return t.next=13,(0,s.getAliOosClient)("bwcoin");case 13:return o=t.sent,r=n[a],console.log("file",r),t.next=18,o.put("spu-imgs-"+e.form.spuName.replace(/\s/g,"-")+a+"."+r.extname,r.file);case 18:l=t.sent,console.log("result",l),n[a]={imgUrl:l.name};case 21:a++,t.next=8;break;case 24:if(console.log("typeof this.form.mainUrl",typeof e.form.mainUrl),"object"!==typeof e.form.mainUrl){t.next=36;break}return t.next=28,(0,s.getAliOosClient)("bwcoin");case 28:return c=t.sent,u=e.form.mainUrl,console.log("file",u),t.next=33,c.put("spu-main-url-"+e.form.spuName.replace(/\s/g,"-")+"."+u[0].extname,u[0].file);case 33:m=t.sent,console.log("result",m),e.form.mainUrl=[m.name];case 36:f={spuName:e.form.spuName,price:e.form.price,desc:e.form.desc,type:e.form.type,imgs:e.form.imgs,mainUrl:e.form.mainUrl[0]},console.log("params",f),uni.request({url:"".concat(e.$baseUrl,"/spu/create"),method:"POST",data:f,success:function(e){e&&(uni.showToast({title:"新增成功"}),setTimeout((function(){uni.navigateBack({delta:1},2e3)})))},fail:function(e){console.log("err",e)}});case 39:case"end":return t.stop()}}),t)})))()},validateFile:function(e){return!(e.size/1024/1024>.1)||(this.messageToggle("error"),!1)},selectMain:function(e){console.log("file",e),this.form.mainUrl=e.tempFiles},select:function(e){var t;console.log("选择文件：",e),(t=this.form.imgs).push.apply(t,(0,a.default)(e.tempFiles)),console.log("this.form.imgs",this.form.imgs)},deletephoto:function(e){console.log("e",e);var t=this.form.imgs.findIndex((function(t){e.tempFilePath,t.url}));this.form.imgs.splice(t,1),console.log("this.form.imgs",this.form.imgs)},progress:function(e){console.log("上传进度：",e)},success:function(e){console.log("上传成功",e)},fail:function(e){console.log("上传失败：",e)},changeType:function(e){console.log("e:-----",e)},handleBut:function(){console.log("===="),uni.navigateBack({delta:1})}}};t.default=c},"58cf":function(e,t,i){"use strict";i.r(t);var n=i("2c4d"),a=i("d13c");for(var o in a)"default"!==o&&function(e){i.d(t,e,(function(){return a[e]}))}(o);i("14e3");var s,r=i("f0c5"),l=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"3084c72a",null,!1,n["a"],s);t["default"]=l.exports},a202:function(e,t,i){var n=i("fb7d");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=i("4f06").default;a("1b896b38",n,!0,{sourceMap:!1,shadowMode:!1})},d13c:function(e,t,i){"use strict";i.r(t);var n=i("55b8"),a=i.n(n);for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},fb7d:function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".view[data-v-3084c72a]{margin:1rem}.submit[data-v-3084c72a]{margin:2rem}.file-picker__box[data-v-3084c72a]{width:100px;height:100px}",""]),e.exports=t}}]);