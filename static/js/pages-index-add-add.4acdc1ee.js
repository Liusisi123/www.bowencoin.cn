(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-add-add"],{"020a":function(e,t,n){"use strict";var i=n("4ea4");n("c740"),n("d81d"),n("a434"),n("ac1f"),n("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("2909"));n("96cf");var s=i(n("1da1")),o=n("9114"),r=n("19aa9"),l={mixins:[r.spuAllTypeMixins],data:function(){return{msgType:"success",messageText:"",title:"新增",form:{spuName:"",price:"",title:"",type:"",mainUrl:[],imgs:[]},typeOpts:[]}},mounted:function(){this.initspuAllTypeOptsMixins()},onLoad:function(e){e.item&&(this.form=JSON.parse(decodeURIComponent(e.item)))},methods:{addSub:function(){var e=this;return(0,s.default)(regeneratorRuntime.mark((function t(){var n,i,a,s,r,l,u,c,f,m;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.form.spuCode){t.next=5;break}n={spuName:e.form.spuName,price:e.form.price,desc:e.form.desc,spuCode:e.form.spuCode},uni.request({url:"".concat(e.$baseUrl,"/spu/update"),method:"POST",data:n,success:function(e){uni.showToast({title:"编辑成功"}),setTimeout((function(){uni.navigateBack({delta:1})}),2e3)},fail:function(e){}}),t.next=39;break;case 5:i=e.form.imgs,console.log("list",i),a=0;case 8:if(!(a<i.length)){t.next=24;break}if(console.log("list[i]",i[a]),"object"!==typeof i[a]){t.next=21;break}return t.next=13,(0,o.getAliOosClient)("bwcoin");case 13:return s=t.sent,r=i[a],console.log("file",r),t.next=18,s.put("spu-imgs-"+e.form.spuName.replace(/\s/g,"-")+a+"."+r.extname,r.file);case 18:l=t.sent,console.log("result",l),i[a]={imgUrl:l.name};case 21:a++,t.next=8;break;case 24:if(console.log("typeof this.form.mainUrl",typeof e.form.mainUrl),"object"!==typeof e.form.mainUrl){t.next=36;break}return t.next=28,(0,o.getAliOosClient)("bwcoin");case 28:return u=t.sent,c=e.form.mainUrl,console.log("file",c),t.next=33,u.put("spu-main-url-"+e.form.spuName.replace(/\s/g,"-")+"."+c[0].extname,c[0].file);case 33:f=t.sent,console.log("result",f),e.form.mainUrl=[f.name];case 36:m={spuName:e.form.spuName,price:e.form.price,desc:e.form.desc,type:e.form.type,imgs:e.form.imgs,mainUrl:e.form.mainUrl[0]},console.log("params",m),uni.request({url:"".concat(e.$baseUrl,"/spu/create"),method:"POST",data:m,success:function(e){e&&(uni.showToast({title:"新增成功"}),setTimeout((function(){uni.navigateBack({delta:1},2e3)})))},fail:function(e){console.log("err",e)}});case 39:case"end":return t.stop()}}),t)})))()},getTypeRange:function(){var e=this;uni.request({url:"".concat(this.$baseUrl,"/spu/type"),method:"POST",success:function(t){if(t){console.log("res.data",t.data);var n=t.data.data;e.typeOpts=n.map((function(e){return{text:e.name+"("+e.id+")",value:e.id}}))}},fail:function(e){}})},validateFile:function(e){return!(e.size/1024/1024>.1)||(this.messageToggle("error"),!1)},selectMain:function(e){this.form.mainUrl=e.tempFiles},select:function(e){var t;console.log("选择文件：",e),(t=this.form.imgs).push.apply(t,(0,a.default)(e.tempFiles)),console.log("this.form.imgs",this.form.imgs)},deletephoto:function(e){var t=this.form.imgs.findIndex((function(t){e.tempFilePath,t.url}));this.form.imgs.splice(t,1)},progress:function(e){console.log("上传进度：",e)},success:function(e){console.log("上传成功",e)},fail:function(e){console.log("上传失败：",e)},changeType:function(e){console.log("e:-----",e)},handleBut:function(){console.log("===="),uni.navigateBack({delta:1})}}};t.default=l},"114e":function(e,t,n){"use strict";n.r(t);var i=n("df18"),a=n("faf9");for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);n("177f");var o,r=n("f0c5"),l=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"a3b921d0",null,!1,i["a"],o);t["default"]=l.exports},"177f":function(e,t,n){"use strict";var i=n("f398"),a=n.n(i);a.a},df18:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return i}));var i={uniForms:n("71e4").default,uniFormsItem:n("aeba").default,uniEasyinput:n("17de").default,uniDataSelect:n("1e7f").default,uniFilePicker:n("9612").default,uniPopup:n("be18").default,uniPopupMessage:n("bd5d").default},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"view"},[this.form.spuCode?n("v-uni-view",{staticStyle:{"font-size":"16px","font-weight":"bold"}},[e._v("编辑")]):n("v-uni-view",{staticStyle:{"font-size":"16px","font-weight":"bold"}},[e._v("新增")]),n("uni-forms",{attrs:{modelValue:e.form,"label-position":"left","label-width":"100px"}},[n("uni-forms-item",{attrs:{label:"商品名称:",name:"spuName"}},[n("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入商品名称"},model:{value:e.form.spuName,callback:function(t){e.$set(e.form,"spuName",t)},expression:"form.spuName"}})],1),n("uni-forms-item",{attrs:{label:"价格:",name:"price"}},[n("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入价格"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),n("uni-forms-item",{attrs:{label:"描述:",name:"desc"}},[n("uni-easyinput",{staticStyle:{width:"400rpx"},attrs:{type:"text",placeholder:"请输入标题"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),n("uni-forms-item",{attrs:{label:"所属分类:",name:"type"}},[n("uni-data-select",{staticStyle:{width:"400rpx"},attrs:{localdata:e.spuAllTypeOptsMixins},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.changeType.apply(void 0,arguments)}},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),n("uni-forms-item",{attrs:{label:"上传主页图:",name:"mainUrl"}},[n("uni-file-picker",{ref:"uploadMain",attrs:{fileMediatype:"image","del-icon":!1,"disable-preview":!0,limit:"1"},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.selectMain.apply(void 0,arguments)}},model:{value:e.form.mainUrl,callback:function(t){e.$set(e.form,"mainUrl",t)},expression:"form.mainUrl"}})],1),n("uni-forms-item",{attrs:{label:"上传详情图:",name:"type"}},[n("uni-file-picker",{ref:"upload",attrs:{fileMediatype:"image",mode:"grid",limit:"9"},on:{select:function(t){arguments[0]=t=e.$handleEvent(t),e.select.apply(void 0,arguments)},progress:function(t){arguments[0]=t=e.$handleEvent(t),e.progress.apply(void 0,arguments)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.success.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deletephoto.apply(void 0,arguments)},fail:function(t){arguments[0]=t=e.$handleEvent(t),e.fail.apply(void 0,arguments)}},model:{value:e.form.imgs,callback:function(t){e.$set(e.form,"imgs",t)},expression:"form.imgs"}})],1)],1),n("v-uni-view",{staticClass:"jump-next-area"},[n("v-uni-button",{staticClass:"jump-next submit",attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.addSub.apply(void 0,arguments)}}},[e._v("保存")]),n("v-uni-button",{staticClass:"jump-next submit",attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleBut.apply(void 0,arguments)}}},[e._v("取消")])],1),n("v-uni-view",[n("uni-popup",{ref:"message",attrs:{type:"message"}},[n("uni-popup-message",{attrs:{type:e.msgType,message:e.messageText,duration:2e3}})],1)],1)],1)},s=[]},ea2b:function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,".view[data-v-a3b921d0]{margin:1rem}.submit[data-v-a3b921d0]{margin:2rem}.file-picker__box[data-v-a3b921d0]{width:100px;height:100px}",""]),e.exports=t},f398:function(e,t,n){var i=n("ea2b");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("4f06").default;a("6e04be22",i,!0,{sourceMap:!1,shadowMode:!1})},faf9:function(e,t,n){"use strict";n.r(t);var i=n("020a"),a=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=a.a}}]);